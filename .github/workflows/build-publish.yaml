name: to `build` branch and publish

on:
  push:
    #branches:
    #  - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Main Branch
      uses: actions/checkout@v2
      with:
        ref: 'build'
        fetch-depth: 0  # Fetches all history for all branches and tags - including main.

    - name: Set up Pandoc
      run: sudo apt-get install pandoc

    - name: check location
      run: ls -al

    # - name: Run smooth (needs Pandoc) on Repository Files
    #   run: ./smoo.sh
    #     # Run Pandoc commands here
    #     # Example: pandoc -s input.md -o output.html

    - name: update build branch for files
      run: |
        git config user.name 'github-actions[bot]'
        git config user.email 'github-actions[bot]@users.noreply.github.com'
        git merge origin/main
        # run smoosh
        ./smoo.sh
        # commit changes and push to build
        git add .
        git commit -m "ðŸ‘· Documentation - Auto Generate Build and Publish ðŸ‘·\n\nChanges at '"${GITHUB_SHA}"
        git push origin build --force
      env:
        GITHUB_TOKEN: ${{ secrets.MRJS_AND_DOCS_REPO_PAT }}
